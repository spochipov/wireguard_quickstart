# WireGuard Quickstart — Документация проекта

Краткая, упорядоченная документация по проекту. Вся основная информация и инструкции вынесены в отдельные файлы для удобства.

Важное примечание: все установочные и административные скрипты предназначены для запуска от root. Запуск через не требуется — просто выполните команды под пользователем root.

Содержимое репозитория и документация:
- QUICK_START.md — пошаговая инструкция по быстрой установке и первоначальной проверке.
- README.md — этот файл: обзор, ссылки на подробные инструкции, структура проекта.
- scripts/README.md — документация по вспомогательным скриптам (как их использовать и где они устанавливаются).
- /etc/wireguard/clients — каталог с конфигурациями клиентов (не изменять вручную в репозитории).

Если нужно — детальная документация по каждому скрипту и примеры использования находятся в `scripts/README.md`.

## Быстрый обзор

Цель проекта
- Автоматизировать развёртывание WireGuard сервера с поддержкой IPv4/IPv6, настройкой firewall и удобными утилитами для добавления/удаления клиентов.

Ключевые скрипты (установочные и утилиты)
- `wg-server-setup.sh` — основной установочный скрипт (настраивает систему, генерирует ключи, создаёт /etc/wireguard/wg0.conf и устанавливает утилиты).
- `wg-add-client.sh` — генерирует конфиг клиента и добавляет peer в серверный конфиг.
- `wg-remove-client.sh`, `wg-list-clients.sh` — управление клиентами.
- `wg-debug-internet.sh` — диагностика проблем доступа в интернет для клиентов.
- `scripts/change-wg-port.sh` — утилита для изменения ListenPort на сервере (скрипт также обновляет правила firewall и может быть установлен в /usr/local/bin).
- Доп. скрипты в каталоге `scripts/` помогают с firewall и диагностикой.

Куда устанавливаются утилиты
- При установке большинство утилит копируются в `/usr/local/bin/` и становятся доступными в PATH, например:
  - `/usr/local/bin/wg-add-client`
  - `/usr/local/bin/wg-server-info`
  - `/usr/local/bin/change-wg-port`

Структура проекта (в репозитории)
- wg-server-setup.sh
- wg-add-client.sh
- wg-remove-client.sh
- wg-list-clients.sh
- wg-debug-internet.sh
- wg-performance-test.sh
- scripts/
  - change-wg-port.sh
  - wg-firewall-recommendations.sh
  - add-wg-input-rule.sh
  - clean-duplicates-and-save.sh
  - run-wg-diagnostics-and-collect.sh
  - WG_apply_commands.txt
- clients/  (локально: конфиги клиентов — оставляем без изменений)

Важно: директория `clients/` содержит клиентские конфигурации и не изменяется скриптом документации.

## Что сделано (последние изменения)
- Добавлена утилита `change-wg-port.sh` для смены порта WireGuard и управления правилами firewall.
- `wg-add-client.sh` улучшен: при генерации клиента порт для Endpoint берётся из `/etc/wireguard/wg0.conf`.
- Добавлена поддержка UFW/firewalld и автосохранение правил через netfilter-persistent в скрипте смены порта.
- Скрипты для очистки дублирующих правил и для сбора диагностики добавлены в `scripts/`.

## Управление сервером (выполнять как root)

Основные команды (запускать от root — не нужен)
```bash
# Добавить нового клиента
wg-add-client <имя_клиента>

# Показать информацию о сервере
wg-server-info

# Показать активные подключения
wg show

# Создать резервную копию
wg-backup

# Диагностика проблем с интернетом
./wg-debug-internet.sh

# Тестирование производительности
./wg-performance-test.sh

# Перезапустить WireGuard
systemctl restart wg-quick@wg0

# Проверить статус
systemctl status wg-quick@wg0
```

## Тестирование производительности

Для проверки и оптимизации производительности VPN используйте скрипт:
```bash
# Запустить полный тест производительности
./wg-performance-test.sh
```

## Управление клиентами (выполнять как root)
- Генерация клиента:
  wg-add-client <client_name>
- Файлы клиентов сохраняются в /etc/wireguard/clients/

## Сохранение правил между перезагрузками
Рекомендуется установить iptables-persistent/netfilter-persistent (выполнять как root — не нужен):
```bash
apt update
apt install -y iptables-persistent netfilter-persistent
# согласитесь сохранить текущие правила при установке
netfilter-persistent save
```

Если пакет не устанавливается, скрипты сохраняют правила в `/etc/iptables/rules.v4` и `/etc/iptables/rules.v6` (если каталог существует).

## Дополнительно
- QUICK_START.md — быстрый старт и последовательность действий.
- scripts/README.md — подробное описание вспомогательных скриптов.

## Лицензия
MIT License
